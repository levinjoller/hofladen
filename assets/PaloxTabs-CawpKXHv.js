const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DropdownSearchModal-By3ZU8q_.js","assets/index-B4NoDcFB.js","assets/index-CV2ytict.css","assets/use-db-action-CqLjSPSZ.js","assets/_plugin-vue_export-helper-DlAUqK2U.js","assets/use-db-action-DTt0FHhZ.css","assets/is-numeric-key-DsADXjeW.js","assets/PaloxIntoStockStepperModal-B_VsK8xb.js","assets/PaloxListPage-MSbGyCLw.js","assets/PaloxListPage-BxrlA5ZL.css","assets/product-types-BIT3DkQM.js","assets/customer-list-schema-CSgvwQ6m.js","assets/persons-Cmw6zaTL.js","assets/supplier-list-schema-B4OYM1ea.js"])))=>i.map(i=>d[i]);
import{t as _,ar as E,d as Y,r as P,c as Z,A as C,o as M,b as m,w as h,e as p,f as ee,s as y,as as te,at as w,F as I,au as oe,av as ae,h as b,aw as se,ax as T,ay as re,az as ne,aA as le,i as ce,l as N,H as ie,y as A,aB as z,G as B,_ as D}from"./index-B4NoDcFB.js";import{o as i,i as o,a as d,p as v,d as g,b as L,s as k,c as de,g as ue}from"./use-db-action-CqLjSPSZ.js";import{P as pe,a as me}from"./product-types-BIT3DkQM.js";import{a as he}from"./customer-list-schema-CSgvwQ6m.js";import{a as _e}from"./supplier-list-schema-B4OYM1ea.js";import{L as j}from"./PaloxListPage-MSbGyCLw.js";import{_ as fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Se=i({p_palox_type_id:o(),p_palox_number:o().min(1).max(9999),p_stock_column_slot_id:o(),p_product_id:o(),p_supplier_id:o(),p_customer_id:o().nullable().optional()}),ke=i({...pe.omit({created_at:!0,fk_product_type:!0}).shape,type:i({...me.pick({emoji:!0}).shape})}),ye=d(ke),R=i({id:o(),created_at:v(e=>typeof e=="string"?new Date(e):e,g()),stock:o()});d(R);const we=i({...R.omit({created_at:!0}).shape}),ve=d(we),ge=i({...he.omit({created_at:!0}).shape}),xe=d(ge),be=i({..._e.omit({created_at:!0}).shape}),Pe=d(be),Ce=i({slot_id:o(),display_name:k(),is_full:L(),free_levels:o(),current_taken_levels:o()}),Me=d(Ce),Ie=i({stock_column_id:o(),column_number:o(),fk_stock:o(),slots:Me}),Te=d(Ie),Ne=i({level:o(),palox_id:o(),display_name:k()}),Ae=d(Ne),ze=i({slot_id:o(),slot_display_name:k(),slot:o(),max_level:o(),levels:Ae});d(ze);const $=i({id:o(),created_at:v(e=>typeof e=="string"?new Date(e):e,g()),label_prefix:k(),display_name:k(),description:o().nullable(),next_palox_number:o(),is_default:L()});d($);const Be=i({...$.pick({id:!0,label_prefix:!0,display_name:!0,is_default:!0}).shape}),De=d(Be),V=i({id:o(),created_at:v(e=>typeof e=="string"?new Date(e):e,g()),fk_customer:o().nullable(),fk_product:o(),fk_supplier:o(),fk_stock_column_slot_level:o().nullable(),fk_palox_type:o(),number_per_type:o(),stored_at:v(e=>typeof e=="string"?new Date(e):e,g()).nullable()});d(V);const je=i({...V.pick({id:!0,number_per_type:!0}).shape});d(je);async function it(e=""){let t=_.from("suppliers").select("\n      id,\n      person:fk_person!inner (\n        display_name\n      )\n    "),s=e.trim();s&&(t=t.ilike("person.display_name","%".concat(s,"%")).limit(5));const{data:a,error:n}=await t;if(n)throw n;if(!a)return[];const r=Pe.safeParse(a);if(!r.success)throw r.error;return r.data.map(l=>({id:l.id,display_name:l.person.display_name})).sort((l,f)=>l.display_name.localeCompare(f.display_name))}async function dt(e=""){let t=_.from("customers").select("\n      id,\n      person:fk_person!inner (\n        display_name\n      )\n    "),s=e.trim();s&&(t=t.ilike("person.display_name","%".concat(s,"%")).limit(5));const{data:a,error:n}=await t;if(n)throw n;if(!a)return[];const r=xe.safeParse(a);if(!r.success)throw r.error;return r.data.map(l=>({id:l.id,display_name:l.person.display_name})).sort((l,f)=>l.display_name.localeCompare(f.display_name))}async function ut(e=""){let t=_.from("products").select("\n      id, \n      display_name,\n      type:fk_product_type (\n        emoji\n      )\n      ").order("display_name",{ascending:!0}),s=e.trim();s&&(t=t.ilike("display_name","%".concat(s,"%")).limit(15));const{data:a,error:n}=await t;if(n)throw n;if(!a)return[];const r=ye.safeParse(a);if(!r.success)throw r.error;return r.data.map(l=>({id:l.id,display_name:"".concat(l.type.emoji," ").concat(l.display_name)}))}async function Ee(){const{data:e,error:t}=await _.from("stocks").select("id, stock").order("stock",{ascending:!0});if(t)throw t;if(!e)return[];const s=ve.safeParse(e);if(!s.success)throw s.error;return s.data.map(a=>({id:a.id,display_name:a.stock.toString()}))}async function pt(e){let t=_.from("palox_types").select("id, label_prefix, display_name, is_default").order("is_default",{ascending:!1}).order("label_prefix",{ascending:!0});e&&(t=t.eq("is_default",!0).limit(1));const{data:s,error:a}=await t;if(a)throw a;if(!s)return[];const n=De.safeParse(s);if(!n.success)throw n.error;return n.data.map(r=>({id:r.id,display_name:"".concat(r.label_prefix," (").concat(r.display_name,")")}))}async function mt(e){const{data:t,error:s}=await _.from("stock_column_slots_by_column_view").select().eq("fk_stock",e).order("column_number",{ascending:!0});if(s)throw s;if(!t)return[];const a=Te.safeParse(t);if(!a.success)throw a.error;return a.data}const Le=async e=>{var n;const t=Se.safeParse({p_palox_type_id:e.paloxTypeId,p_palox_number:e.paloxNumber,p_stock_column_slot_id:e.stockColumnSlotId,p_product_id:e.productId,p_supplier_id:e.supplierId,p_customer_id:e.customerId});if(!t.success)throw t.error;const{data:s,error:a}=await _.rpc("assign_palox_to_next_free_level_in_slot_fnc",{...t.data,p_customer_id:(n=t.data.p_customer_id)!=null?n:void 0});if(a)throw a;return s},{errorMessage:Re,isLoading:$e,execute:Ve}=de(Le),qe=()=>({currentStep:1,selectedPaloxType:null,selectedPaloxNumber:null,selectedSupplier:null,selectedCustomer:null,selectedProduct:null,selectedStock:null,selectedStockColumnSlot:null}),Oe=E("paloxIntoStock",{state:()=>qe(),getters:{isActionLoading(){return $e.value},actionErrorMessage(){return Re.value},canProceed(e){switch(e.currentStep){case 1:return!!(e.selectedPaloxType&&e.selectedPaloxNumber&&e.selectedSupplier&&e.selectedProduct&&e.selectedStock);case 2:return!!e.selectedStockColumnSlot;default:return!1}}},actions:{async submitStepTwo(){var e;return await Ve({paloxTypeId:this.selectedPaloxType.id,paloxNumber:this.selectedPaloxNumber,stockColumnSlotId:this.selectedStockColumnSlot.slot_id,productId:this.selectedProduct.id,supplierId:this.selectedSupplier.id,customerId:(e=this.selectedCustomer)==null?void 0:e.id})},async nextStep(){if(!this.canProceed)return{success:!1,showSuccessToast:!1,closeModal:!1};if(this.currentStep>=2){const e=await this.submitStepTwo();return{success:e,showSuccessToast:e,closeModal:!0}}return this.currentStep++,{success:!0,showSuccessToast:!1,closeModal:!1}},prevStep(){this.currentStep>1&&this.currentStep--}}}),Fe=i({id:o(),display_name:k().nullable()}),He=()=>({_currentStockItem:null}),We=E("stockStore",{state:()=>He(),getters:{getCurrentStockItem(e){return e._currentStockItem}},actions:{setCurrentStockItem(e){if(!e){this._currentStockItem=null;return}const t=Fe.safeParse(e);if(t.success)this._currentStockItem=t.data;else throw t.error}},persist:!0}),Ge="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20stroke='currentColor'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'%20class='icon%20icon-tabler%20icons-tabler-outline%20icon-tabler-box'%3e%3cpath%20stroke='none'%20d='M0%200h24v24H0z'%20fill='none'/%3e%3cpath%20d='M12%203l8%204.5l0%209l-8%204.5l-8%20-4.5l0%20-9l8%20-4.5'%20/%3e%3cpath%20d='M12%2012l8%20-4.5'%20/%3e%3cpath%20d='M12%2012l0%209'%20/%3e%3cpath%20d='M12%2012l-8%20-4.5'%20/%3e%3c/svg%3e",Je="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20stroke='currentColor'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'%20class='icon%20icon-tabler%20icons-tabler-outline%20icon-tabler-box-off'%3e%3cpath%20stroke='none'%20d='M0%200h24v24H0z'%20fill='none'/%3e%3cpath%20d='M17.765%2017.757l-5.765%203.243l-8%20-4.5v-9l2.236%20-1.258m2.57%20-1.445l3.194%20-1.797l8%204.5v8.5'%20/%3e%3cpath%20d='M14.561%2010.559l5.439%20-3.059'%20/%3e%3cpath%20d='M12%2012v9'%20/%3e%3cpath%20d='M12%2012l-8%20-4.5'%20/%3e%3cpath%20d='M3%203l18%2018'%20/%3e%3c/svg%3e",Ue="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20stroke='currentColor'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'%20class='icon%20icon-tabler%20icons-tabler-outline%20icon-tabler-replace'%3e%3cpath%20stroke='none'%20d='M0%200h24v24H0z'%20fill='none'/%3e%3cpath%20d='M3%203m0%201a1%201%200%200%201%201%20-1h4a1%201%200%200%201%201%201v4a1%201%200%200%201%20-1%201h-4a1%201%200%200%201%20-1%20-1z'%20/%3e%3cpath%20d='M15%2015m0%201a1%201%200%200%201%201%20-1h4a1%201%200%200%201%201%201v4a1%201%200%200%201%20-1%201h-4a1%201%200%200%201%20-1%20-1z'%20/%3e%3cpath%20d='M21%2011v-3a2%202%200%200%200%20-2%20-2h-6l3%203m0%20-6l-3%203'%20/%3e%3cpath%20d='M3%2013v3a2%202%200%200%200%202%202h6l-3%20-3m0%206l3%20-3'%20/%3e%3c/svg%3e",Ke="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20stroke='currentColor'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'%20class='icon%20icon-tabler%20icons-tabler-outline%20icon-tabler-sort-ascending-2'%3e%3cpath%20stroke='none'%20d='M0%200h24v24H0z'%20fill='none'/%3e%3cpath%20d='M14%209l3%20-3l3%203'%20/%3e%3cpath%20d='M5%205m0%20.5a.5%20.5%200%200%201%20.5%20-.5h4a.5%20.5%200%200%201%20.5%20.5v4a.5%20.5%200%200%201%20-.5%20.5h-4a.5%20.5%200%200%201%20-.5%20-.5z'%20/%3e%3cpath%20d='M5%2014m0%20.5a.5%20.5%200%200%201%20.5%20-.5h4a.5%20.5%200%200%201%20.5%20.5v4a.5%20.5%200%200%201%20-.5%20.5h-4a.5%20.5%200%200%201%20-.5%20-.5z'%20/%3e%3cpath%20d='M17%206v12'%20/%3e%3c/svg%3e",Qe="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20stroke='currentColor'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'%20class='icon%20icon-tabler%20icons-tabler-outline%20icon-tabler-reorder'%3e%3cpath%20stroke='none'%20d='M0%200h24v24H0z'%20fill='none'/%3e%3cpath%20d='M3%2015m0%201a1%201%200%200%201%201%20-1h2a1%201%200%200%201%201%201v2a1%201%200%200%201%20-1%201h-2a1%201%200%200%201%20-1%20-1z'%20/%3e%3cpath%20d='M10%2015m0%201a1%201%200%200%201%201%20-1h2a1%201%200%200%201%201%201v2a1%201%200%200%201%20-1%201h-2a1%201%200%200%201%20-1%20-1z'%20/%3e%3cpath%20d='M17%2015m0%201a1%201%200%200%201%201%20-1h2a1%201%200%200%201%201%201v2a1%201%200%200%201%20-1%201h-2a1%201%200%200%201%20-1%20-1z'%20/%3e%3cpath%20d='M5%2011v-3a3%203%200%200%201%203%20-3h8a3%203%200%200%201%203%203v3'%20/%3e%3cpath%20d='M16.5%208.5l2.5%202.5l2.5%20-2.5'%20/%3e%3c/svg%3e",Xe={class:"toolbar-content"},Ye=["onClick","aria-label"],Ze={class:"popover-buttons"},et=Y({__name:"PaloxTabs",emits:["refetch-parent-data"],setup(e,{emit:t}){const s=B({loader:()=>D(()=>import("./DropdownSearchModal-By3ZU8q_.js"),__vite__mapDeps([0,1,2,3,4,5,6])),loadingComponent:j,delay:200}),a=B({loader:()=>D(()=>import("./PaloxIntoStockStepperModal-B_VsK8xb.js"),__vite__mapDeps([7,1,2,3,4,5,8,9,6,10,11,12,13])),loadingComponent:j,delay:200}),n=Oe(),r=We(),l=P(!1),f=P(null),q=Z(()=>{var u;return((u=r.getCurrentStockItem)==null?void 0:u.display_name)||"-"}),O=t;function x(){l.value=!1}function F(u){u.preventDefault(),f.value=u,l.value=!0}function H(){r.$reset(),x(),A("Standardlager erfolgreich zurückgesetzt.","success",3e3)}async function W(){const u=await z.create({component:s,componentProps:{title:"Standardlager",fetchMethod:Ee,isSearchable:!1,searchType:"numeric"}});await u.present();const{data:c}=await u.onDidDismiss();if(c)try{r.setCurrentStockItem(c)}catch(S){A(ue(S),"danger",1e4)}}async function G(){n.$reset();const u=await z.create({component:a});await u.present();const{data:c}=await u.onDidDismiss();c&&O("refetch-parent-data")}function J(){}function U(){}function K(){}function Q(){}const X=[{label:"Einlagern",icon:Ge,handler:G},{label:"Sortieren",icon:Ke,handler:J},{label:"Verschieben",icon:Qe,handler:K},{label:"Tauschen",icon:Ue,handler:U},{label:"Auslagern",icon:Je,handler:Q}];return(u,c)=>(M(),C(T,null,[m(p(le),null,{default:h(()=>[m(p(ee),null,{default:h(()=>[y("div",Xe,[m(p(te),{onClick:W,onContextmenu:w(F,["prevent"]),onPointerdown:c[0]||(c[0]=w(()=>{},["stop"])),onMousedown:c[1]||(c[1]=w(()=>{},["stop"])),onTouchstart:c[2]||(c[2]=w(()=>{},["stop"]))},{default:h(()=>[m(p(I),{icon:p(oe)},null,8,["icon"]),m(p(ae),null,{default:h(()=>[b(se(q.value),1)]),_:1})]),_:1}),(M(),C(T,null,re(X,S=>y("div",{key:S.label,class:"ion-activatable ripple-parent",onClick:S.handler,"aria-label":S.label},[m(p(I),{src:S.icon,size:"large"},null,8,["src"]),m(p(ne))],8,Ye)),64))])]),_:1})]),_:1}),m(p(ie),{"is-open":l.value,event:f.value,onDidDismiss:x,"keep-contents-mounted":!0},{default:h(()=>[m(p(ce),{class:"ion-padding"},{default:h(()=>[c[5]||(c[5]=y("p",null,"Standardlager zurücksetzen?",-1)),y("div",Ze,[m(p(N),{color:"medium",fill:"outline",expand:"block",onClick:x},{default:h(()=>[...c[3]||(c[3]=[b(" Nein ",-1)])]),_:1}),m(p(N),{color:"primary",expand:"block",onClick:H},{default:h(()=>[...c[4]||(c[4]=[b(" Ja ",-1)])]),_:1})])]),_:1})]),_:1},8,["is-open","event"])],64))}}),tt=fe(et,[["__scopeId","data-v-972fe490"]]),ht=Object.freeze(Object.defineProperty({__proto__:null,default:tt},Symbol.toStringTag,{value:"Module"}));export{ht as P,it as a,ut as b,Ee as c,dt as d,mt as e,pt as f,Oe as u};
