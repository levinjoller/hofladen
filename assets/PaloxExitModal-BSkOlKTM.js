const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SelectWithSearch-D6un5e8Q.js","assets/vendor-ionic-DL3WDV-g.js","assets/vendor-grid-Bad8I008.js","assets/index-YNPHqK-K.js","assets/index-CfmnWJvu.css","assets/search-type-BiWLnLKr.js","assets/LoadingSpinner-DgHZcYJm.js","assets/LoadingSpinner-BxrlA5ZL.css"])))=>i.map(i=>d[i]);
import{a as j,b as M,c as O,w as L,t as b,h as W,d as $,e as H,A as G,k as K,v as Q,_ as Y,C as z}from"./vendor-ionic-DL3WDV-g.js";import{s as J,d as X,f as Z,p as w,c as ee}from"./index-YNPHqK-K.js";import{D as k,F as te,i as ae,f as R,j as oe}from"./PaloxListPage-BxSjq6nu.js";import{o as se,fG as ne,gl as re,u as le,L as ce}from"./LoadingSpinner-DgHZcYJm.js";import{c as i,N as ie,I as ue,k as de,w as pe,b as fe,q as F,m as E,x as r,Q as s,u as t,R as me,U as A,Y as xe,l as Pe}from"./vendor-grid-Bad8I008.js";import{S as _e}from"./search-type-BiWLnLKr.js";import"./product-types-CV3CSiow.js";import"./customer-list-schema-BqaoqCG1.js";import"./persons-CQb0edLH.js";import"./supplier-list-schema-DiLhSYiL.js";const Se=se({p_palox_id:ne().int()});async function ge(e){const l=Se.safeParse(e);if(!l.success)throw l.error;const{error:u}=await J.rpc("remove_palox_and_shift_down",{...l.data});if(u)throw u}const he=1,D=()=>({currentStep:1,_currentPaloxItem:null,_selectedPaloxType:null,_isActionLoading:!1,actionErrorMessage:null}),ye=X("paloxExitStore",()=>{const e=ue(D()),{execute:l}=re(ge,(a,n)=>{e._isActionLoading=a,e.actionErrorMessage=n}),u=i(()=>e._currentPaloxItem),p=i(()=>e._selectedPaloxType),g=i(()=>e._isActionLoading),h=i(()=>e.actionErrorMessage),m=i(()=>ae(he)(e.currentStep)),x=i(()=>!!e._currentPaloxItem&&!!e._selectedPaloxType);function y(){Object.assign(e,D())}function P(a){if(!a){e._currentPaloxItem=null;return}const n=k.safeParse(a);if(!n.success)throw n.error;e._currentPaloxItem=n.data}function I(a){if(e._currentPaloxItem=null,!a){e._selectedPaloxType=null;return}const n=k.safeParse(a);if(!n.success)throw n.error;e._selectedPaloxType=n.data}async function f(a){return await l({p_palox_id:a}),!e.actionErrorMessage}async function _(){if(!x.value||!e._currentPaloxItem)return te;if(m.value){const a=await f(e._currentPaloxItem.id);return{success:a,parentReloadRequired:a,closeModal:a,isCompleted:!0}}return e.currentStep++,{success:!0,parentReloadRequired:!1,closeModal:!1,isCompleted:!1}}function v(){e.currentStep>1&&e.currentStep--}return{...ie(e),isActionLoading:g,getCurrentPaloxItem:u,getActionErrorMessage:h,getSelectedPaloxType:p,isFinalStep:m,canProceed:x,setCurrentPaloxItem:P,setSelectedPaloxType:I,nextStep:_,prevStep:v,executeFinalAction:f,resetStore:y}}),Ie={key:1},Re=de({__name:"PaloxExitModal",props:{title:{}},setup(e){const l=xe({loader:()=>Y(()=>import("./SelectWithSearch-D6un5e8Q.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])),loadingComponent:ce,delay:200}),u=o=>!o||!S.value?Promise.resolve([]):oe(o,S.value.id),p=ye(),{nextStep:g,setCurrentPaloxItem:h,setSelectedPaloxType:m,resetStore:x}=p,{currentStep:y,isActionLoading:P,getActionErrorMessage:I,getCurrentPaloxItem:f,getSelectedPaloxType:_,canProceed:v,isFinalStep:a}=Z(p),n=i({get:()=>f.value,set:o=>h(o)}),S=i({get:()=>_.value,set:o=>m(o)}),{data:T,isLoading:V,execute:N}=le(R);pe(I,o=>{o&&w(o,"danger",1e4)}),fe(async()=>{x(),await N(!0),Array.isArray(T.value)&&T.value.length>0?p.setSelectedPaloxType(T.value[0]):w("Es wurde keinen Standardwert fÃ¼r die Paloxenart gefunden.","warning")});async function B(){const{success:o,parentReloadRequired:c,closeModal:d}=await g();if(o&&d){const U=q();w(U,"success",6e3),C(c)}}function q(){return`Die Paloxe ${_.value?.display_name}-${f.value?.display_name} wurde erfolgreich ausgelagert.`}function C(o){z.dismiss(o)}return(o,c)=>(E(),F(t(Q),null,{default:r(()=>[s(t(j),null,{default:r(()=>[s(t(M),null,{default:r(()=>[s(t(O),null,{default:r(()=>[me(A(e.title)+" - "+A(t(y))+" / 1",1)]),_:1}),s(t(L),{slot:"end"},{default:r(()=>[s(t(b),{onClick:c[0]||(c[0]=d=>C(!1))},{default:r(()=>[s(t(W),{icon:t(ee)},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),s(t($),{class:"ion-padding"},{default:r(()=>[s(t(H),null,{default:r(()=>[s(t(l),{title:"Paloxenart",modelValue:S.value,"onUpdate:modelValue":c[1]||(c[1]=d=>S.value=d),fetchMethod:()=>t(R)(!1),isSearchable:!1,isParentLoading:t(V)},null,8,["modelValue","fetchMethod","isParentLoading"]),s(t(l),{title:"Paloxennummer",modelValue:n.value,"onUpdate:modelValue":c[2]||(c[2]=d=>n.value=d),fetchMethod:u,isSearchable:!0,searchType:t(_e).Numeric},null,8,["modelValue","searchType"])]),_:1})]),_:1}),s(t(G),null,{default:r(()=>[s(t(M),null,{default:r(()=>[s(t(L),{slot:"end"},{default:r(()=>[s(t(b),{onClick:B,disabled:!t(v)||t(P)},{default:r(()=>[t(P)?(E(),F(t(K),{key:0,name:"crescent"})):(E(),Pe("span",Ie,A(t(a)?"Speichern":"Weiter"),1))]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1}))}});export{Re as default};
